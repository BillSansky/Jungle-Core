fileFormatVersion: 2
guid: 8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e
MonoImporter:
  externalObjects: {}
  serializedVersion: 2
  defaultReferences: []
  executionOrder: 0
  icon: {instanceID: 0}
  userData: 
  assetBundleName: 
  assetBundleVariant: 
using System.Collections.Generic;
using UnityEngine;

namespace Jungle.Events
{
    /// <summary>
    /// Singleton manager that handles signal broadcasting and reception.
    /// </summary>
    public class SignalManager : MonoBehaviour
    {
        private static SignalManager _instance;
        
        public static SignalManager Instance
        {
            get
            {
                if (_instance == null)
                {
                    _instance = FindObjectOfType<SignalManager>();
                    
                    if (_instance == null)
                    {
                        GameObject go = new GameObject("SignalManager");
                        _instance = go.AddComponent<SignalManager>();
                        DontDestroyOnLoad(go);
                    }
                }
                return _instance;
            }
        }

        private Dictionary<SignalAsset, List<SignalReceiver>> _receivers = new Dictionary<SignalAsset, List<SignalReceiver>>();

        private void Awake()
        {
            if (_instance != null && _instance != this)
            {
                Destroy(gameObject);
                return;
            }

            _instance = this;
            DontDestroyOnLoad(gameObject);
        }

        /// <summary>
        /// Registers a receiver for a specific signal.
        /// </summary>
        public void RegisterReceiver(SignalAsset signal, SignalReceiver receiver)
        {
            if (signal == null || receiver == null) return;

            if (!_receivers.ContainsKey(signal))
            {
                _receivers[signal] = new List<SignalReceiver>();
            }

            if (!_receivers[signal].Contains(receiver))
            {
                _receivers[signal].Add(receiver);
            }
        }

        /// <summary>
        /// Unregisters a receiver from a specific signal.
        /// </summary>
        public void UnregisterReceiver(SignalAsset signal, SignalReceiver receiver)
        {
            if (signal == null || receiver == null) return;

            if (_receivers.ContainsKey(signal))
            {
                _receivers[signal].Remove(receiver);
            }
        }

        /// <summary>
        /// Raises a signal to all registered receivers.
        /// </summary>
        public void RaiseSignal(SignalAsset signal)
        {
            if (signal == null) return;

            if (_receivers.ContainsKey(signal))
            {
                // Create a copy to avoid modification during iteration
                var receivers = new List<SignalReceiver>(_receivers[signal]);
                
                foreach (var receiver in receivers)
                {
                    if (receiver != null && receiver.gameObject.activeInHierarchy)
                    {
                        receiver.OnSignalRaised(signal);
                    }
                }
            }
        }

        /// <summary>
        /// Clears all registered receivers.
        /// </summary>
        public void ClearAll()
        {
            _receivers.Clear();
        }
    }
}

